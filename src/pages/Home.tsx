import styled from 'styled-components';
import CardLayout from '../components/layout/CardLayout';
import { AllItems, TopItems, nearByItem } from '../apis/getItems/Item';
import { useQueries } from 'react-query';
import { useLocation, useNavigate } from 'react-router-dom';
import { useEffect } from 'react';
import { getCookie } from '../utils/cookie';
import { SyncLoader } from 'react-spinners';
import { useRecoilValue } from 'recoil';
import { myDataState } from '../Atoms';
import RecommendLayout from '../components/layout/RecommendLayout';

export default function Home() {
  const navigate = useNavigate();
  const token = getCookie('token');
  const { state } = useLocation();

  const data = useRecoilValue(myDataState);

  useEffect(() => {
    if (state) {
      if (!data?.shop_name || !data?.location_name) {
        navigate('welcome');
      }
    }
  }, [data]);

  const queryResults = useQueries([
    { queryKey: 'items', queryFn: () => AllItems({ page: 0, pageSize: 8, Selling: 'SELLING' }) },
    { queryKey: 'topitems', queryFn: () => TopItems({ page: 0, pageSize: 8, Selling: 'SELLING' }) },
    { queryKey: 'recommenditems', queryFn: () => TopItems({ page: 0, pageSize: 9, Selling: 'SELLING' }) },
    ...(token ? [{ queryKey: 'nearBy', queryFn: () => nearByItem({ token, page: 0, pageSize: 8, Selling: 'SELLING' }) }] : []),
  ]);

  const itemsResult = queryResults[0];
  const topItemsResult = queryResults[1];
  const recommendResult = queryResults[2];
  const nearByResult = queryResults[3];

  if (itemsResult.isLoading || topItemsResult.isLoading) {
    return (
      <Loading>
        <SyncLoader color="black" margin={10} size={28} />
      </Loading>
    );
  }

  return (
    <>
      <Layout>
        <Banner>
          <Explanation>
            <h1>편리하게 의류를 쇼핑하는 온라인 빈티지샵</h1>
            <svg xmlns="http://www.w3.org/2000/svg" width="181" height="56" viewBox="0 0 181 56" fill="none">
              <g clipPath="url(#clip0_1354_10310)">
                <path
                  d="M25.429 52.0958C25.429 51.0002 25.6098 49.7828 25.9111 48.3828C26.2124 46.9828 26.6945 45.2176 27.2368 43.0263C27.8996 40.7132 28.442 38.7654 28.7433 37.1828C29.1048 35.6002 29.2253 34.1393 29.2253 32.8611C29.2253 29.5741 27.7791 27.8698 24.8867 27.8698C24.1034 27.8698 23.32 27.9915 22.4764 28.1741L16.6916 55.6872H6.26687L16.2095 9.30455L26.9355 7.84368L23.3803 24.7045H23.9828C25.8509 24.7045 27.5984 24.035 29.1651 22.7567C30.7318 21.4176 31.9972 19.7741 32.9011 17.8263C33.805 15.8785 34.2268 13.9306 34.2268 12.0437C34.2268 9.79151 33.5639 7.96542 32.2382 6.50455C30.9126 5.04368 28.924 4.37411 26.2727 4.37411C22.3559 4.37411 18.9211 5.10455 16.0287 6.50455C13.0761 7.90455 10.7863 9.97411 9.21954 12.6524C7.59256 15.3306 6.8092 18.4959 6.8092 22.148C6.8092 23.9741 6.98998 25.1915 7.29127 25.9219C7.65282 26.6524 7.77333 27.0176 7.77333 27.1393C5.18222 27.1393 3.25395 26.5915 1.92827 25.4959C0.662842 24.4002 0 22.5741 0 20.0785C0 16.9741 1.26543 13.9306 3.79628 11.0089C6.32713 8.08716 9.58109 5.65238 13.4979 3.82629C17.4147 2.0002 21.3917 1.08716 25.3688 1.08716C28.9843 1.08716 31.9972 1.63498 34.4678 2.66977C36.9384 3.76542 38.7462 5.16542 39.9513 6.93064C41.1565 8.69585 41.7591 10.6437 41.7591 12.7132C41.7591 15.0263 41.036 17.2785 39.65 19.5915C38.2641 21.9045 36.3358 23.7306 33.9255 25.1915C35.7332 25.7393 37.0589 26.5915 37.782 27.8698C38.5051 29.148 38.9269 30.6698 38.9269 32.4959C38.9269 33.8959 38.7462 35.4176 38.4449 37.0002C38.0833 38.5828 37.6012 40.5306 36.9987 42.9045C36.6371 44.4263 36.2756 45.8872 35.914 47.348C35.5525 48.8089 35.4319 50.0263 35.4319 51.0002C35.4319 52.0959 35.673 53.1306 36.2153 53.9828C36.6974 54.835 37.4205 55.4437 38.2641 55.8089C35.3114 56.6611 32.9613 57.0263 31.0933 57.0263C27.3573 57.0263 25.429 55.3828 25.429 52.1567V52.0958Z"
                  fill="#2667FF"
                />
                <path
                  d="M68.993 42.6612C66.7635 45.1568 64.7147 47.0438 62.8467 48.2612C60.9787 49.4786 58.7491 50.0873 56.158 50.0873C54.3502 50.0873 53.0245 49.6612 52.1809 48.809C51.3976 47.9568 50.9758 46.3133 50.9758 43.9394C50.9758 43.4525 51.036 42.4786 51.0963 41.0177C51.3976 39.0699 51.3373 39.496 51.6989 37.4873C52.422 33.5916 53.6271 30.122 55.2541 27.0786C56.9413 23.9742 58.6286 22.4525 60.3761 22.4525C61.5812 22.4525 62.1838 23.4264 62.1838 25.4351C62.1838 27.4438 61.7018 29.3307 60.6774 31.1568C59.7132 32.922 58.3875 34.4438 56.7606 35.6003C55.9772 36.209 55.1336 36.6351 54.29 36.9394V40.5307C56.0375 40.1655 57.6644 39.496 59.2914 38.6438C61.8223 37.2438 63.8711 35.4177 65.4378 33.1047C66.9442 30.8525 67.7276 28.296 67.7276 25.6177C67.7276 20.9307 65.0762 18.5568 59.7735 18.5568C55.2541 18.5568 51.5181 20.0786 48.5654 23.0003C45.6128 25.922 43.5037 29.4525 42.2383 33.4699C40.9126 37.5481 40.2498 41.2003 40.2498 44.609C40.2498 48.5655 41.2742 51.4873 43.2024 53.3742C45.1909 55.2612 47.9628 56.1742 51.5181 56.1742C59.4722 56.1742 66.1006 51.6699 71.4034 42.6612H68.993Z"
                  fill="#2667FF"
                />
                <path
                  d="M95.3725 7.64795C96.4572 6.5523 97.8431 5.9436 99.4099 5.9436C100.977 5.9436 102.363 6.49143 103.507 7.64795C104.652 8.7436 105.195 10.1436 105.195 11.7262C105.195 13.3088 104.652 14.7088 103.507 15.8653C102.363 17.0219 101.037 17.5697 99.4099 17.5697C97.7829 17.5697 96.4572 17.0219 95.3725 15.8653C94.2879 14.7088 93.6853 13.3697 93.6853 11.7262C93.6853 10.0827 94.2276 8.7436 95.3725 7.64795ZM114.113 11.1784C115.198 10.0827 116.584 9.47404 118.15 9.47404C119.717 9.47404 121.103 10.0219 122.248 11.1784C123.393 12.274 123.935 13.674 123.935 15.2566C123.935 16.8393 123.393 18.2393 122.248 19.3958C121.103 20.5523 119.777 21.1001 118.15 21.1001C116.523 21.1001 115.198 20.5523 114.113 19.3958C113.028 18.2393 112.426 16.9001 112.426 15.2566C112.426 13.6132 112.968 12.274 114.113 11.1784Z"
                  fill="#2667FF"
                />
                <path
                  d="M121.818 45.3868C121.035 45.9955 119.046 46.9694 117.42 45.3259C116.998 44.8998 116.757 44.1694 116.757 43.1955C116.757 42.4042 116.757 41.6129 117.058 40.8824L122.24 25.1781H111.815L106.935 39.4824C106.332 41.4911 105.549 43.0738 104.584 44.2303C103.62 45.3259 102.475 45.9346 101.15 45.9346C99.7035 45.9346 98.9805 44.8998 98.9805 42.952C98.9805 42.2824 99.0407 41.6129 99.1612 40.8824L104.404 25.1781H93.979L89.0378 39.4824C88.6763 41.4303 88.4955 43.0129 88.4955 44.2303C88.4955 47.152 89.1583 49.3433 90.6045 50.8042C92.0507 52.2651 93.9187 52.9955 96.2086 52.9955C98.0766 52.9955 99.9446 52.5085 101.752 51.5346C103.56 50.5607 105.247 48.7346 106.935 46.0564C107.176 48.3694 107.899 50.0738 109.104 51.2303C110.369 52.4477 111.996 52.9955 114.045 52.9955C116.696 52.9955 120.854 49.4651 122.963 47.4564"
                  fill="#2667FF"
                />
                <path
                  d="M146.531 36.6348C143.819 25.0087 144.542 22.3913 151.773 14.113L135.986 16.2435C134.72 20.2609 133.395 24.0348 132.009 27.5043C130.623 30.9739 124.296 43.8783 123.271 45.0348C123.331 46.3739 125.2 50.9391 127.971 52.6435C129.538 53.5565 131.527 53.9826 133.816 53.9826C135.865 53.9826 137.974 53.6174 140.023 52.9478C140.385 52.8261 140.746 52.6435 141.108 52.4609C145.627 50.0261 147.977 44.7304 147.134 39.6174C147.013 38.7043 146.772 37.7304 146.531 36.6348ZM135.986 46.6174C134.781 47.713 133.274 48.2 131.527 48.2C129.96 48.2 128.815 47.8348 128.152 46.9826C127.61 46.3739 127.128 45.4 127.128 44.0609C127.128 42.7217 135.263 27.9913 136.408 24.0956C136.588 26.0435 136.89 29.7565 137.372 35.2956C137.673 37.913 137.794 39.9826 137.794 41.4435C137.794 43.8174 137.191 45.5217 135.986 46.6174Z"
                  fill="#2667FF"
                />
                <path
                  d="M152.8 51.1831C150.811 49.2961 149.847 46.3744 149.847 42.357C149.847 39.0091 150.51 35.2961 151.775 31.2787C153.041 27.2613 155.21 23.7309 158.163 20.8091C161.115 17.8874 164.851 16.3657 169.371 16.3657C174.673 16.3657 177.325 18.6787 177.325 23.3657C177.325 26.1048 176.541 28.6004 175.035 30.9135C173.468 33.2265 171.419 35.0526 168.889 36.4526C166.358 37.8526 163.586 38.6439 160.693 38.8265C160.573 40.2874 160.573 41.2613 160.573 41.7483C160.573 44.1222 160.995 45.7657 161.778 46.6178C162.622 47.47 163.947 47.8961 165.755 47.8961C168.346 47.8961 170.576 47.2874 172.444 46.07C174.312 44.8526 176.361 43.0265 178.53 40.5309H181.001C175.638 49.5396 169.009 54.0439 161.115 54.0439C157.56 54.0439 154.788 53.1309 152.8 51.2439V51.1831ZM166.358 33.4091C167.985 32.2526 169.25 30.7309 170.275 28.9657C171.299 27.2004 171.781 25.2526 171.781 23.2439C171.781 21.2352 171.178 20.2613 169.973 20.2613C168.226 20.2613 166.539 21.7831 164.851 24.8874C163.164 27.9918 162.019 31.4613 161.296 35.357C163.104 35.2352 164.791 34.6265 166.418 33.47L166.358 33.4091Z"
                  fill="#2667FF"
                />
              </g>
              <defs>
                <clipPath id="clip0_1354_10310">
                  <rect width="181" height="56" fill="white" />
                </clipPath>
              </defs>
            </svg>
            <p>
              의류만을 사고 팔 수 있는 의류 특화 중고거래 사이트에서 <br /> 힘들이지 않고 쇼핑해보세요
            </p>
          </Explanation>
          <Images>
            <img className="img1" src="https://ifh.cc/g/nA0d7J.png" />
            <img className="img2" src="https://ifh.cc/g/L2gAF6.png" />
          </Images>
        </Banner>
        <CardLayout title={'인기 상품'} data={topItemsResult.data} />
        <RecommendLayout title={'추천 상품'} data={recommendResult.data} />
        <CardLayout title={'최신 상품'} data={itemsResult.data} />
        {token && <CardLayout title={'내 주위 상품'} data={nearByResult.data} />}
      </Layout>
    </>
  );
}

const Layout = styled.div`
  width: 78.125rem;
  display: flex;
  flex-direction: column;
  margin-top: 3.13rem;
  margin-bottom: 3.13rem;
  gap: 3.12rem;
`;

const Banner = styled.div`
  width: 80rem;
  height: 21.875rem;
  background-color: white;

  display: flex;
`;

const Explanation = styled.div`
  width: 40rem;
  margin: 4.94rem 4.06rem;
  display: flex;
  flex-direction: column;
  gap: 1.25rem;

  h1 {
    font-size: 1.875rem;
    font-style: normal;
    font-weight: 700;
    line-height: normal;
  }

  p {
    font-size: 1.25rem;
    font-style: normal;
    font-weight: 500;
    line-height: 1.875rem;
  }
`;

const Images = styled.div`
  width: 40rem;
  display: flex;
  align-items: end;
  .img1 {
    width: 11.125rem;
    height: 13.6875rem;
  }
  .img2 {
    width: 15.1875rem;
    height: 18.9375rem;
  }
`;

const Loading = styled.div`
  display: flex;
  width: 100%;
  height: 67.5rem;
  justify-content: center;
  align-items: center;
`;
